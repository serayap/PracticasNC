<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Administracion</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />
    <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales/es.global.min.js'></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Firebase (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <!-- html a Pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.0/html2pdf.bundle.min.js"></script>
    <script>
        let usuarioActual = {};

        function actualizarUI() {
            document.getElementById('tituloReservas').textContent = `Administración de las reservas de prácticas con Carlos`;

            cargarListadoAlumnos();
            cargarReservas();

            //document.getElementById('formReserva').addEventListener('submit', crearReserva);
            document.getElementById('contenidoAyuda').innerHTML = ayudaCalendario;
        }

        function dct(e) {
            const bytes = CryptoJS.AES.decrypt(e, "34#-2?579/fbh%$l(Oñh05t@");
            return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
        }
        const firebaseConfig = dct("U2FsdGVkX1/wVoGGAPam24EP2C4b4c5OTPYzVoVmcY3hFxXHl+PfMkhFPUbKc8cRmwTvM44kMrg2sXgyT1mMB5/t3bUiIjIQDe1suqcD2SMvW7RVdJ1jCasaAMGo7a529bxkmCH6zKx+5iysRXw5PIzCKpUh1IGyItrCekPNJjt6zk4g8tP3qDNZizE4u62WVlvG4tp68iHasgwgYWkgzHhuN5/aYc4cRumfEDLPzz1Yf0EbSk3QM5QeGQDGficRCyNbgyaFbqj83wnjHWX4kZQ2iKddEdtNUqqjYHe0Mc0n5YI31rLP5o9dtAONCrrFRadsW0bfVC1ZCQWm5/JoLsi/6Xgxv0Oy3f7b8ncnNbCtsiYZhkgsPn7v2TU+CH/LBm5rUeVTji6lKNh2CYHs+A==");

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        // Inicializa Firestore si no lo has hecho
        const db = firebase.firestore();

        auth.onAuthStateChanged(async user => {
            if (!user) {
                window.location.href = "index.html";
                return;
            }

            try {
                const q = await db.collection('usuarios_registrados')
                    .where('usuarioId', '==', user.uid)
                    .get();
                if (!q.empty) {
                    usuarioActual.id = q.docs[0].id;
                    usuarioActual.nombre = q.docs[0].data().nombre;
                    usuarioActual.email = q.docs[0].data().email;
                    usuarioActual.perfil = q.docs[0].data().perfil;
                    usuarioActual.uid = user.uid;

                    // Control de acceso por perfil
                    if (usuarioActual.perfil !== "administracion") {
                        window.location.href = "index.html";
                        return;
                    }

                    document.body.classList.remove("oculto");

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', actualizarUI);
                    } else {
                        actualizarUI();
                    }
                } else {
                    console.warn("No existe documento para ese usuarioId en usuarios_registrados");
                    window.location.href = "index.html";
                }
            } catch (err) {
                console.error("Error buscando documento de usuario registrado:", err);
                //window.location.href = "index.html";
            }
        });

    </script>
    <style>
        body {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 60%, #e0e0e0 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

            body.oculto {
                visibility: hidden;
            }

        .container {
            display: flex;
            flex-direction: column;
            max-width: 1000px;
            margin: 0 auto;
            gap: 0;
        }

        .subcabecera-creditos {
            background: #e3f2fd;
            color: #1976d2;
            font-weight: 600;
            font-size: 1.1em;
            padding: 8px 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(25,103,210,0.07);
        }


        .cabecera-principal {
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
            font-size: 1.3rem; /* Un poco más pequeño */
            font-weight: 900;
            background: linear-gradient(90deg, #1976d2 20%, #42a5f5 80%);
            color: transparent;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px; /* Menos separación */
            text-align: center;
            margin: 16px auto 8px auto; /* Mucho menos margen arriba y abajo */
            text-shadow: 0 1px 4px rgba(25, 118, 210, 0.08); /* Sombra más sutil */
            animation: gradient-move 3s linear infinite alternate;
            padding: 4px 0; /* Menos padding vertical */
            border-bottom: 2px solid #1976d2; /* Más fino */
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 12px rgba(25, 118, 210, 0.05); /* Sombra más pequeña */
            max-width: 1000px; /* Más estrecho */
        }

        .reserva-item-compacta {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Espacio entre texto y botón */
            gap: 8px;
            padding: 2px 0;
            font-size: 0.95em;
            white-space: nowrap; /* Evita saltos de línea */
            border: 1px solid gray; /* Borde azul */
            border-radius: 6px; /* Esquinas redondeadas */
            background: #f5faff; /* Fondo suave opcional */
        }

        .cta-btn-solicitar {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 6px auto; /* Centrado con margen vertical */
            background: linear-gradient(90deg, #1976d2 60%, #63a4ff 100%);
            color: #fff;
            text-decoration: none;
            padding: 4px 6px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(25, 118, 210, 0.13);
            border: none;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s, color 0.2s, transform 0.1s;
            min-width: 150px;
            max-width: 100%;
        }

            .cta-btn-solicitar:hover {
                background: linear-gradient(90deg, #1565c0 40%, #1976d2 100%);
                box-shadow: 0 8px 24px rgba(25, 118, 210, 0.21);
                color: #fff;
                transform: scale(1.05);
            }


        .cta-btn-pendiente {
            display: flex;
            flex-shrink: 0;
            justify-content: flex-end;
            gap: 8px;
            background: linear-gradient(90deg, #ff9800 60%, #ffb347 100%); /* naranja vibrante */
            color: #fff; /* texto oscuro para destacar sobre naranja claro */
            text-decoration: none;
            padding: 2px 10px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: 300;
            box-shadow: 0 2px 12px rgba(255, 152, 0, 0.10);
            border: none;
            transition: background 0.2s, box-shadow 0.2s, color 0.2s;
        }

            .cta-btn-pendiente:hover {
                background: linear-gradient(90deg, #ff5722 30%, #ff9800 100%); /* naranja más intenso al pasar el ratón */
                color: #fff; /* texto blanco para máximo contraste */
                box-shadow: 0 4px 16px rgba(255, 152, 0, 0.18);
            }

        .cta-btn-confirmada {
            display: flex;
            flex-shrink: 0; /* El botón nunca se encoge */
            justify-content: flex-end; /* Alinea todo a la derecha */
            gap: 8px; /* Espacio entre botones, opcional */
            background: linear-gradient(90deg, #56ab2f 30%, #a8e063 100%);
            color: #fff;
            text-decoration: none;
            padding: 2px 10px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: 300;
            box-shadow: 0 2px 12px rgba(25,103,210,0.08);
            border: none;
            transition: background 0.2s, box-shadow 0.2s;
        }

            .cta-btn-confirmada:hover {
                background: linear-gradient(90deg, #ff4b2b 30%, #ff416c 100%);
                box-shadow: 0 4px 16px rgba(255, 65, 108, 0.15);
                color: #fff; /* Opcional, por si quieres asegurar el color */
                /* Puedes agregar más efectos si lo deseas */
            }

        .cta-btn-confirmada-disabled {
            background: linear-gradient(90deg, #bdbdbd 30%, #eeeeee 100%);
            color: #757575;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 300;
            padding: 2px 10px;
            box-shadow: 0 2px 8px rgba(189, 189, 189, 0.13);
            opacity: 0.7;
            cursor: not-allowed;
            pointer-events: auto; /* Permite mostrar el tooltip aunque esté deshabilitado */
            position: relative;
            transition: background 0.2s, color 0.2s, opacity 0.2s;
        }

            /* Tooltip personalizado al pasar el ratón */
            .cta-btn-confirmada-disabled[title]:hover::after {
                content: attr(title);
                position: absolute;
                left: 50%;
                top: 110%;
                transform: translateX(-50%);
                background: #333;
                color: #fff;
                padding: 4px 10px;
                border-radius: 5px;
                font-size: 0.85em;
                white-space: nowrap;
                z-index: 10;
                opacity: 0.95;
                pointer-events: none;
            }


        @keyframes gradient-move {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 100% 50%;
            }
        }

        .cabecera {
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: #1976d2;
            background: linear-gradient(90deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 8px 16px;
            border-radius: 8px;
            margin-bottom: 18px;
            letter-spacing: 1px;
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.07);
            display: inline-block;
            text-align: center;
        }

        .arriba {
            display: flex;
            flex-direction: row;
            gap: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        .columna-alumnos, .columna-calendario {
            width: 50%;
            min-width: 0; /* Evita desbordamiento */
            box-sizing: border-box;
        }

        .nuevoalumno, .listadoalumno {
            /*flex: 1 1 0;*/
            min-width: 300px;
            background: #fff;
            border-radius: 12px;
            padding: 2px 10px 10px 10px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            margin-bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center; /* Centra todo el contenido hijo horizontalmente */
        }

        #listadoAlumnos {
            width: 100%;
            max-height: 300px; /* Ajusta la altura máxima según tu diseño */
            overflow-y: auto; /* Activa el scroll vertical cuando sea necesario */
            border: 1px solid #e0e0e0; /* Opcional: para delimitar visualmente el área */
            padding: 8px 0;
            background: #fff;
        }

        #formReserva .cta-btn {
            display: block;
            margin: 16px auto 0 auto; /* Centra horizontalmente */
        }

        #calendar-container {
            width: 500px; /* Cambia a tu gusto */
            margin: 0 auto; /* Centra el calendario */
        }

        #calendar {
            min-width: 200px;
            background: #fff;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            margin-bottom: 0;
            width: 100%;
            box-sizing: border-box;
            height: 350px !important; /* Altura máxima total */
        }

        .fc-toolbar {
            padding: 2px 0 !important; /* Reduce el espacio vertical */
            min-height: 0 !important;
            padding-bottom: 4px !important;
            margin-bottom: 8px !important;
        }

        .fc-toolbar-title {
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            font-size: 1.5rem !important;
            font-weight: 5700;
            color: #1565c0;
            padding: 2px 8px !important;
            letter-spacing: 1px;
        }

        .fc .fc-button {
            background: #1976d2;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            transition: background 0.2s;
        }

            .fc .fc-button:hover,
            .fc .fc-button:focus {
                background: #1565c0;
            }

        .seccion-derecha {
            flex: 2;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
        }

        /* Panel de reservas del día */
        .reservas-dia {
            background: #fff;
            border-radius: 12px;
            padding: 2px 2px 2px 2px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            max-height: 400px;
            overflow-y: auto;
            text-align: center;
        }

        /* Elementos de la lista */
        #lista-reservas-dia, #datosAlumno {
            margin-top: 15px;
        }

        .reserva-dia-item {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid transparent;
        }

            .reserva-dia-item.pendiente {
                border-color: #ff9800;
            }

            .reserva-dia-item.confirmada {
                border-color: #4caf50;
            }

            .reserva-dia-item.anulada {
                border-color: #ff6a6a;
            }

            .reserva-dia-item.examen {
                border-color: #ef63f8;
            }

        @media (max-width: 900px) {
            .arriba {
                flex-direction: column;
                gap: 0;
            }

            #calendar {
                min-width: 0;
                width: 100%;
                margin-bottom: 20px;
            }


            /* En tu media query para pantallas grandes */
            #calendar-container {
                width: 700px !important; /* Mayor ancho del contenedor */
            }

            .fc-daygrid-day {
                min-width: 80px !important; /* Ancho mayor para celdas */
            }

            .columna-alumnos, .columna-calendario {
                width: 100%;
            }
        }


        /* Añade esto para control general de altura */
        .fc .fc-daygrid-day {
            height: 40px !important; /* Altura fija para todas las celdas */
        }

        .fc-daygrid-day-events {
            /*min-height: 18px !important;
            margin-top: auto;*/
            min-height: 0 !important;
            margin-top: auto !important; /* Empuja los eventos hacia abajo */
            flex-grow: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            box-sizing: border-box !important;
        }

        .fc-daygrid-day-bg {
            padding: 0 !important;
            margin: 0 !important;
            box-sizing: border-box !important;
        }

        .fc-daygrid-day-number {
            line-height: 1 !important;
            padding: 2px !important;
            font-size: 0.85em !important;
        }

        .fc-dot-pendiente,
        .fc-dot-confirmada {
            transform: scale(0.7) !important;
            margin: 0 1px !important;
        }

        .fc-daygrid-day {
            height: 32px !important; /* Altura máxima de la celda */
            min-height: 32px !important;
            padding: 0 !important;
            margin: 0 !important;
            box-sizing: border-box !important;
        }

        .fc-daygrid-day-frame {
            /*height: 100%;
            display: flex;
            flex-direction: column;*/
            height: 100% !important;
            min-height: 100% !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: flex-start !important;
            padding: 0 !important;
            margin: 0 !important;
            box-sizing: border-box !important;
        }

        .fc-daygrid-day-top {
            flex-wrap: nowrap !important;
            gap: 2px !important;
            height: 24px !important; /* Altura fija para la sección superior */
            min-height: 24px !important;
            margin: 0 !important;
            padding: 0 !important;
            flex-shrink: 0 !important;
            box-sizing: border-box !important;
        }

        /* Ajusta el header del calendario */
        .fc-col-header {
            height: 30px !important;
        }

        .fc-col-header-cell {
            height: 100% !important;
            padding: 2px !important;
        }

        .fc-scrollgrid {
            border: none !important;
        }

        .fc-daygrid-body tr {
            height: 32px !important;
            min-height: 32px !important;
            max-height: 32px !important;
        }

        .fc-scrollgrid-sync-table {
            height: 100% !important;
            min-height: 0 !important;
        }

        /* Contenedor de la vista */
        .fc-view-harness {
            min-height: 0 !important;
        }

        .leyenda-colores {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
        }

        .leyenda-item {
            display: flex;
            align-items: center;
        }

        .dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 2px;
            vertical-align: middle;
        }

        .dot-pendiente {
            background: #FF9800;
        }

        .dot-confirmada {
            background: #4CAF50;
        }

        .dot-examen {
            background-color: #ef63f8;
        }

        .form {
            max-width: 280px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

            .form-group label {
                min-width: 80px;
                /*margin-right: 8px;*/
                font-size: 13px;
                font-weight: 500;
                text-align: right;
            }

        .input {
            flex: 1;
            padding: 3px 6px;
            border: 1px solid #bbb;
            border-radius: 4px;
            font-size: 12px;
            box-sizing: border-box;
        }

        .btn.cta-btn-confirmada {
            width: 100%;
            padding: 6px;
            margin-top: 6px;
            background: #388e3c;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-sizing: border-box;
            min-height: 28px; /* Por si el texto es pequeño */
        }

            .btn.cta-btn-confirmada:hover {
                background: #2e7031;
            }

        .tabla {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            background: #fff;
            box-shadow: 0 2px 8px rgba(25, 103, 210, 0.06);
            font-size: 14px;
            border-radius: 8px;
            overflow: hidden;
            table-layout: auto; /* O 'fixed' si quieres columnas iguales */
        }

            .tabla th, .tabla td {
                padding: 7px 12px;
                text-align: left;
                border-bottom: 1px solid #e0e0e0;
            }

            .tabla th {
                background: #1976d2;
                color: #fff;
                font-weight: 600;
                letter-spacing: 0.5px;
                font-size: 14px;
            }

                .tabla th:nth-child(54), .tabla td:nth-child(5) {
                    width: 60px;
                    min-width: 40px;
                    max-width: 70px;
                    text-align: center;
                    padding-right: 0;
                    padding-left: 0;
                }


            .tabla tr:last-child td {
                border-bottom: none;
            }

            .tabla tr:nth-child(even) td {
                background: #f5f7fa;
            }

            .tabla tr:hover td {
                background: #e3f2fd;
                transition: background 0.2s;
            }

        @media (max-width: 600px) {
            .tabla, .tabla th, .tabla td {
                font-size: 12px;
                padding: 6px 8px;
            }
        }

        .reserva-hora {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 1px 4px;
            margin-bottom: 2px;
            background: #f5f7fa;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1;
            box-shadow: none;
            transition: background 0.2s;
            min-height: 0;
        }

            .reserva-hora:hover {
                background: #e3f2fd;
            }

            .reserva-hora .hora {
                font-weight: 500;
                color: #1976d2;
                min-width: 36px;
                line-height: 1;
                padding: 0 1px;
            }

            .reserva-hora .estado {
                font-size: 10px;
                font-weight: 600;
                padding: 0 5px;
                border-radius: 7px;
                margin-left: auto;
                text-transform: capitalize;
                line-height: 1;
                height: 16px;
                display: flex;
                align-items: center;
            }

                /* Colores de estado */
                .reserva-hora .estado.confirmada {
                    background: #c8e6c9;
                    color: #388e3c;
                    border: 1px solid #388e3c;
                }

                .reserva-hora .estado.pendiente {
                    background: #fff9c4;
                    color: #fbc02d;
                    border: 1px solid #fbc02d;
                }

                .reserva-hora .estado.anulada {
                    background: #ffcdd2;
                    color: #d32f2f;
                    border: 1px solid #d32f2f;
                }

                .reserva-hora .estado.examen {
                    background: #e0e0e0;
                    color: #ef63f8;
                    border: 1px solid #757575;
                }


        #lista-reservas-dia, #datosAlumno, .reservasdia {
            display: flex;
            flex-direction: column;
            align-items: center; /* Centra horizontalmente los hijos */
        }

        .eliminar-alumno {
            cursor: pointer;
            font-size: 18px;
            color: #d32f2f;
            transition: color 0.2s;
        }

            .eliminar-alumno:hover {
                color: #b71c1c;
            }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .popup-content {
            background: #fff;
            padding: 10px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close, .closepopup {
            float: right;
            cursor: pointer;
            font-size: 24px;
        }



        .log-creditos-item {
            margin: 8px 0;
            padding: 8px;
            background: #f5f7fa;
            border-radius: 6px;
        }

        .creditos-alumno {
            cursor: pointer; /* Mano al pasar el mouse */
            font-weight: 600;
            transition: color 0.2s;
            text-align: center;
        }

            .creditos-alumno:hover {
                text-decoration: underline;
            }

            .creditos-alumno[data-creditos="0"] {
                color: #d32f2f; /* Rojo si es 0 */
            }

            .creditos-alumno:not([data-creditos="0"]) {
                color: #388e3c; /* Verde si no es 0 */
            }

        #logCreditosTabla.tabla {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            background: #fff;
            box-shadow: 0 2px 8px rgba(25, 103, 210, 0.06);
            font-size: 14px;
            border-radius: 8px;
            overflow: hidden;
        }

            #logCreditosTabla.tabla th, #logCreditosTabla.tabla td {
                padding: 7px 12px;
                text-align: left;
                border-bottom: 1px solid #e0e0e0;
            }

            #logCreditosTabla.tabla th {
                background: #1976d2;
                color: #fff;
                font-weight: 600;
            }

            #logCreditosTabla.tabla tr:last-child td {
                border-bottom: none;
            }

            #logCreditosTabla.tabla tr:nth-child(even) td {
                background: #f5f7fa;
            }

        th.eliminar-col, td.eliminar-col {
            width: 40px;
            min-width: 40px;
            max-width: 40px;
            text-align: center;
            padding: 0;
        }

        .borrar-log {
            cursor: pointer;
            font-size: 18px;
            color: #d32f2f;
            transition: color 0.2s;
        }

            .borrar-log:hover {
                color: #b71c1c;
            }

        @media (max-width: 600px) {
            .tabla-responsive {
                overflow-x: auto;
                display: block;
            }
        }

        #logCreditosTabla th, #logCreditosTabla td {
            padding: 4px 8px;
            font-size: 0.95em;
        }

        .fc-today-button {
            display: none !important;
        }

        .btn-admin {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 6px auto; /* Centrado con margen vertical */
            background: linear-gradient(90deg, #1976d2 60%, #63a4ff 100%);
            color: #fff;
            text-decoration: none;
            padding: 4px 6px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(25, 118, 210, 0.13);
            border: none;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s, color 0.2s, transform 0.1s;
            min-width: 150px;
            max-width: 100%;
        }

            .btn-admin:hover {
                background: linear-gradient(90deg, #1565c0 40%, #1976d2 100%);
                box-shadow: 0 8px 24px rgba(25, 118, 210, 0.21);
                color: #fff;
                transform: scale(1.05);
            }

        .btn-ayuda {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #1976d2;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s ease;
        }

        .popup-content {
            background: #fff;
            padding: 28px 32px;
            border-radius: 16px;
            max-width: 640px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
            transform: translateY(0);
            animation: fadeInUp 0.4s ease-out;
            border: 1px solid rgba(25,118,210,0.1);
        }

            .popup-content h2 {
                font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
                font-size: 1.7rem;
                font-weight: 700;
                color: #1976d2;
                margin-top: 0;
                margin-bottom: 20px;
                text-align: center;
            }

            .popup-content h3 {
                font-family: 'Segoe UI', Arial, sans-serif;
                font-size: 1.2rem;
                font-weight: 600;
                color: #1976d2;
                margin: 16px 0 8px 0;
            }

        #contenedor-pdf {
            width: 100%;
            display: none;
        }

        .divpdfh, .divZum {
            text-align: center;
            margin-bottom: 12px;
            font-size: 0.9em;
            color: #6f4683;
        }

        .div-pdf {
            display: grid;
            grid-template-columns: max-content repeat(5, minmax(50px, 1fr));
            gap: 1px;
            background-color: #e3eafc;
            border-radius: 7px;
            overflow: hidden;
        }

        .time-slot {
            background-color: #e3eafc;
            padding: 2px 8px;
            border-bottom: 1px solid #dde6f3;
            text-align: right;
            font-weight: 600;
            font-size: 1em;
            font-family: 'Open Sans', 'Segoe UI', Arial, sans-serif;
            color: #1976d2;
            letter-spacing: 0.5px;
            white-space: nowrap;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }


        .day-header {
            background-color: #1976d2;
            color: #fff;
            padding: 2px 0;
            text-align: center;
            font-weight: 500;
            font-size: 0.96em;
            border-bottom: 2px solid #1565c0;
            min-width: 0;
        }

        .calendar-cell {
            padding: 0 1px;
            background-color: #fff;
            border-bottom: 1px solid #e3eafc;
            min-height: 0;
            height: auto;
            position: relative;
            box-sizing: border-box;
        }

        .reserva.confirmada {
            background-color: #C8E6C9;
            border-color: #4CAF50;
            text-align: center;
        }        

        .reserva.examen {
            background-color: #ef63f8;
            border-color: #4c4c4c;
            text-align:center;
        }

        .cta-btn-parte {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 6px auto; /* Centrado con margen vertical */
            background: linear-gradient(90deg, #1976d2 60%, #63a4ff 100%);
            color: #fff;
            text-decoration: none;
            padding: 4px 6px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(25, 118, 210, 0.13);
            border: none;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s, color 0.2s, transform 0.1s;
            min-width: 150px;
            max-width: 100%;
        }

            .cta-btn-parte:hover {
                background: linear-gradient(90deg, #1565c0 40%, #1976d2 100%);
                box-shadow: 0 8px 24px rgba(25, 118, 210, 0.21);
                color: #fff;
                transform: scale(1.05);
            }
    </style>
</head>
<body class="oculto">
    <div class="container">
        <h2 class="cabecera-principal" id="tituloReservas"></h2>
        <!--<div id="subcabecera-creditos" class="subcabecera-creditos">
          <span id="creditosUsuario">...</span>
        </div>-->
        <div class="arriba">
            <div id="columna-alumnos" class="columna-alumnos">
                <div class="nuevoalumno">
                    <h2 class="cabecera">Nuevo alumno</h2>
                    <form id="formAlumno" class="form" onsubmit="return false;">
                        <div class="form-group">
                            <label for="emailAlumno">Email</label>
                            <input type="email" id="emailAlumno" class="input" required>
                        </div>
                        <div class="form-group">
                            <label for="apellidosAlumno">Apellidos</label>
                            <input type="text" id="apellidosAlumno" class="input" required>
                        </div>
                        <div class="form-group">
                            <label for="nombreAlumno">Nombre</label>
                            <input type="text" id="nombreAlumno" class="input" required>
                        </div>
                        <button type="button" class="btn cta-btn-confirmada" onclick="agregarAlumno()">Registrar alumno</button>
                    </form>
                    <div id="msgAlumno"></div>
                </div>
                <div class="listadoalumno">
                    <h2 class="cabecera">Listado de alumnos</h2>
                    <div id="listadoAlumnos"></div>
                    <div id="form-group"></div>
                    <div id="msgAlumno"></div>
                </div>
            </div>
            <div id="calendar-container">
                <div id="calendar"></div>
                <!-- Leyenda de colores -->
                <div class="leyenda-colores">
                    <span class="leyenda-item"><span class="dot dot-pendiente"></span>Pendiente</span>
                    <span class="leyenda-item"><span class="dot dot-confirmada"></span>Confirmada</span>
                    <span class="leyenda-item"><span class="dot dot-examen"></span>Examen</span>
                </div>
                <div><button id="descargar-pdf" class="cta-btn-parte">Parte semanal</button></div>
                <div id="contenedor-pdf"><div class="div-pdf" id="div-pdf"></div></div>
                <div class="seccion-derecha">
                    <div class="reservas-dia">
                        <h2 class="cabecera" id="tituloReservasDia">Reservas del día</h2>
                        <div id="lista-reservas-dia"></div>
                    </div>
                    <button id="btnAyuda" class="btn-ayuda">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="popupAyuda" class="popup">
        <div class="popup-content">
            <span class="close">&times;</span>
            <h2>Ayuda</h2>
            <div id="contenidoAyuda">
                <!-- Aquí va el contenido de ayuda específico para cada página -->
            </div>
        </div>
    </div>

    <div id="popupCreditos" class="popup">
        <div class="popup-content">
            <span class="closepopup">&times;</span>
            <h2 class="cabecera" id="titulocreditos"></h2>
            <div id="datosAlumno" class="tabla-responsive"></div>
            <!--<div id="logCreditos"></div>-->
            <table id="logCreditosTabla" class="tabla">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Perfil</th>
                        <th>Antes</th>
                        <th>Reserva o Anulación</th>
                        <th>Despues</th>
                        <th>&nbsp;</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aquí se insertarán las filas dinámicamente -->
                </tbody>
            </table>
            <form id="formSumarCreditos">
                <input type="hidden" id="alumnoId">
                <label for="paqueteCreditos">Paquetes de clases:</label>
                <select id="paqueteCreditos">
                    <option value="5">5 clases</option>
                    <option value="3">3 clases</option>
                    <option value="1">1 clase</option>
                    <!-- Añade más opciones si lo necesitas -->
                </select>
                <button class="btn cta-btn-confirmada" type="submit">Añadir clases</button>
            </form>
            <div id="msgClases"></div>
        </div>
    </div>
    <script>

        const settings = { experimentalForceLongPolling: true, merge: true };
        db.settings(settings);

        let calendar = null;
        let primeraCarga = true;
        let reservasTodas = {};
        let reservasUsuario = [];
        let eventos = [];

        async function agregarAlumno() {
            const email = document.getElementById('emailAlumno').value.trim();
            const apellidos = document.getElementById('apellidosAlumno').value.trim();
            const nombre = document.getElementById('nombreAlumno').value.trim();
            const msg = document.getElementById('msgAlumno');

            // Validación simple
            if (!email || !apellidos || !nombre) {
                msg.textContent = "Por favor, completa todos los campos.";
                msg.style.color = "#d32f2f";
                return;
            }

            // Validación de formato de email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                msg.textContent = "El email no tiene un formato válido.";
                msg.style.color = "#d32f2f";
                return;
            }

            try {
                // Añadir nuevo alumno a Firestore
                await db.collection('usuarios_registrados').add({
                    email: email,
                    Apellidos: apellidos,
                    nombre: nombre,
                    perfil: "alumno",
                    creditos: 0,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    info: false
                });

                msg.textContent = "Alumno registrado correctamente.";
                msg.style.color = "#388e3c";
                document.getElementById('formAlumno').reset();

                // Actualizar listado de alumnos
                if (typeof cargarListadoAlumnos === "function") cargarListadoAlumnos();
            } catch (error) {
                msg.textContent = "Error al registrar alumno: " + error.message;
                msg.style.color = "#d32f2f";
            }
        }

        async function cargarListadoAlumnos() {
            const contenedor = document.getElementById('listadoAlumnos');
            contenedor.innerHTML = "Cargando...";

            try {
                const snapshot = await db.collection('usuarios_registrados')
                    .where("perfil", "==", "alumno")
                    .orderBy("Apellidos")
                    .get();

                if (snapshot.empty) {
                    contenedor.innerHTML = "<p>No hay alumnos registrados.</p>";
                    return;
                }

                // Puedes mostrarlo como tabla o lista
                let html = `<table class="tabla">
                        <tr>
                            <th>Acción</th>
                            <!--<th>Email</th>-->
                            <th>Apellidos</th>
                            <th>Nombre</th>
                            <th>Clases</th>
                        </tr>`;
                snapshot.forEach(doc => {
                    const data = doc.data();
                    html += `<tr>
                            <td><span class="eliminar-alumno" data-id="${doc.id}">🗑️</span></td>
                            <!--<td>${data.email}</td>-->
                            <td>${data.Apellidos || ''}</td>
                            <td>${data.nombre || ''}</td>
                            <td class="creditos-alumno" data-id="${doc.id}" data-usuarioiId="${data.usuarioId}" data-creditos="${data.creditos}">${typeof data.creditos === "number" ? data.creditos : 0}</td>
                        </tr>`;
                });
                html += `</table>`;
                contenedor.innerHTML = html;

                // Añade el listener para el borrado
                document.querySelectorAll('.eliminar-alumno').forEach(icono => {
                    icono.addEventListener('click', eliminarAlumno);
                });

                // Asigna el listener a las clases
                document.querySelectorAll('.creditos-alumno').forEach(celda => {
                    celda.addEventListener('click', abrirPopupCreditos);
                });
            } catch (error) {
                contenedor.innerHTML = `<p style="color:#d32f2f">Error al cargar alumnos: ${error.message}</p>`;
            }
        }

        async function eliminarAlumno(event) {
            const id = event.currentTarget.getAttribute('data-id');
            const confirmar = confirm('¿Seguro que quieres eliminar este alumno?');
            if (confirmar) {
                try {
                    await db.collection('usuarios_registrados').doc(id).delete();
                    //alert('Alumno eliminado correctamente');
                    cargarListadoAlumnos(); // Recarga la lista
                } catch (error) {
                    alert('Error al eliminar alumno: ' + error.message);
                }
            }
        }

        // Variables globales
        let alumnoActualId = null;
        let usuarioId = null;

        // Abrir popup
        async function abrirPopupCreditos(event) {
            alumnoActualId = event.currentTarget.getAttribute('data-id');
            usuarioId = event.currentTarget.getAttribute('data-usuarioiId');
            const popup = document.getElementById('popupCreditos');
            document.getElementById('alumnoId').value = alumnoActualId;
            popup.style.display = 'flex';

            // Cargar datos del alumno
            const alumnoDoc = await db.collection('usuarios_registrados').doc(alumnoActualId).get();
            const alumno = alumnoDoc.data();
            //document.getElementById('datosAlumno').innerHTML = `<p><strong>Nombre:</strong> ${alumno.nombre}</p><p><strong>Apellidos:</strong> ${alumno.apellidos}</p><p><strong>Email:</strong> ${alumno.email}</p>`;
            document.getElementById('titulocreditos').innerHTML = `Historial de clases para ${alumno.nombre}`;
            //console.log(alumnoActualId);
            // Cargar log de créditos (colección independiente)
            const logSnapshot = await db.collection('logcreditos')
                .where('usuarioId', '==', usuarioId)
                .orderBy('fecha', 'asc')
                .get();

            const tbody = document.querySelector('#logCreditosTabla tbody');
            tbody.innerHTML = '';
            if (logSnapshot.empty) {
                tbody.innerHTML = '<tr><td colspan="5">No hay historial de clases</td></tr>';
            } else {
                // Si necesitas el crédito puntual en cada momento, deberías calcularlo acumulando las operaciones
                //console.log(usuarioActual.perfil);
                let acumulado = 0;
                logSnapshot.forEach(doc => {
                    const log = doc.data();
                    const fecha = log.fecha.toDate();
                    acumulado += log.tipo === 'sumar' ? log.reservasImplicadas.length : -log.reservasImplicadas.length;
                    const fila = `
                        <tr>
                            <td>${fecha.toLocaleDateString('es-ES')}</td>
                            <td>${fecha.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}</td>
                            <td>${log.perfil || '-'}</td>
                            <td>${log.creditosAntes}</td>
                            <td>${log.tipo === 'sumar' ? '+' + log.reservasImplicadas.length : log.tipo === 'confirmar' ? 'confirmada' : '-' + log.reservasImplicadas.length}</td>
                            <td>${log.creditosDespues}</td>
                            ${log.perfil === "administracion" ? `<td class="eliminar-col"><span class="borrar-log" data-logid="${doc.id}" data-cantidad="${log.reservasImplicadas.length}">🗑️</span></td>` : ''}
                        </tr>
                    `;
                    tbody.insertAdjacentHTML('beforeend', fila);
                });

                // Añade la fila totalizadora al final
                const totalizador = `
                <tr style="font-weight:bold;">
                    <td colspan="5" style="text-align:right;">Clases actuales:</td>
                    <td>${alumno.creditos}</td>
                </tr>
            `;
                tbody.insertAdjacentHTML('beforeend', totalizador);
            }

        }


        // Cerrar popup
        document.querySelector('.closepopup').addEventListener('click', () => {
            document.getElementById('popupCreditos').style.display = 'none';
            msgClases.innerHTML = "";
        });

        document.getElementById('formSumarCreditos').addEventListener('submit', async function (e) {
            e.preventDefault();
            const id = document.getElementById('alumnoId').value;
            const clases = parseInt(document.getElementById('paqueteCreditos').value);

            let creditosAntes = 0;
            let creditosDespues = 0;
            let alumno = null;
            //let usuarioId = null;

            // Sumar clases al alumno en una transacción
            await db.runTransaction(async (transaction) => {
                const alumnoRef = db.collection('usuarios_registrados').doc(id);
                const alumnoDoc = await transaction.get(alumnoRef);
                alumno = alumnoDoc.data();
                creditosAntes = alumno.creditos || 0;
                creditosDespues = creditosAntes + clases;
                //usuarioId = alumno.usuarioId; // Asegúrate de que este campo existe en el documento
                transaction.update(alumnoRef, { creditos: creditosDespues });
            });

            // Añadir entrada al log de créditos (fuera de la transacción)
            await db.collection('logcreditos').add({
                usuarioId: usuarioId,
                email: alumno.email,
                perfil: usuarioActual.perfil,
                creditosAntes: creditosAntes,
                tipo: "sumar",
                creditosDespues: creditosDespues,
                reservasImplicadas: Array(clases).fill({}), // O ajusta según tu lógica
                fecha: firebase.firestore.FieldValue.serverTimestamp()
            });

            msgClases.style.color = "#388e3c";
            msgClases.innerHTML = "Clase/s añadida/s correctamente.";
            await abrirPopupCreditos({ currentTarget: { getAttribute: (attr) => attr === "data-id" ? id : usuarioId } });
            cargarListadoAlumnos(); // Actualizar tabla
        });

        document.querySelector('#logCreditosTabla tbody').addEventListener('click', async function (event) {
            if (event.target.classList.contains('borrar-log')) {
                const logId = event.target.getAttribute('data-logid');
                const cantidad = parseInt(event.target.getAttribute('data-cantidad'), 10);
                // Recupera el documento del log
                const logDoc = await db.collection('logcreditos').doc(logId).get();
                const log = logDoc.data();
                if (log.tipo !== "sumar") {
                    alert("Solo se pueden borrar operaciones de suma.");
                    return;
                }
                // Confirmación
                if (!confirm(`¿Seguro que quieres borrar este registro y restar ${cantidad} clase(s)?`)) return;

                // Transacción: borrar log y restar créditos
                const alumnoRef = db.collection('usuarios_registrados').doc(alumnoActualId);
                await db.runTransaction(async (transaction) => {
                    const alumnoDoc = await transaction.get(alumnoRef);
                    const creditosActuales = alumnoDoc.data().creditos || 0;
                    const creditosDespues = Math.max(0, creditosActuales - cantidad);
                    transaction.update(alumnoRef, { creditos: creditosDespues });
                    transaction.delete(db.collection('logcreditos').doc(logId));
                });

                // Recarga el popup para reflejar los cambios

                msgClases.style.color = "#388e3c";
                msgClases.innerHTML = "Clase/s eliminada/s correctamente.";
                await abrirPopupCreditos({
                    currentTarget: {
                        getAttribute: (attr) => {
                            if (attr === "data-id") return alumnoActualId;
                            if (attr === "data-usuarioiId") return usuarioId; // Asegúrate de tener este valor disponible
                            return null;
                        }
                    }
                });
                cargarListadoAlumnos(); // Actualizar tabla
            }
        });


        function capitalizarPrimeraLetra(str) {
            return str.replace(/\b\w/g, function (char) {
                return char.toUpperCase();
            });
        }

        // Utilidad: formato YYYY-MM-DD
        function toISODate(date) {
            return date.toISOString().split('T')[0];
        }

        // Cargar días de la semana actual y la siguiente
        function cargarDias() {
            const selectDia = document.getElementById('dia');
            selectDia.innerHTML = "";
            const hoy = new Date();
            for (let i = 1; i < 15; i++) {
                const fecha = new Date(hoy);
                fecha.setDate(hoy.getDate() + i);
                const diaSemana = fecha.getDay(); // 0=domingo, 6=sábado
                if (diaSemana !== 0 && diaSemana !== 6) { // Excluye sábados y domingos
                    const fechaISO = toISODate(fecha);
                    const texto = fecha.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'short' });
                    const option = document.createElement('option');
                    option.value = fechaISO;
                    option.textContent = texto.charAt(0).toUpperCase() + texto.slice(1);
                    selectDia.appendChild(option);
                }

            }
        }

        // Función para cargar reservas del día
        async function cargarReservasDelDia(fechaStr) {
            const lista = document.getElementById('lista-reservas-dia');
            lista.innerHTML = '<div class="cargando">Cargando...</div>';

            try {
                // Actualizar título con formato "Reservas del lunes, 12 de mayo"
                const tituloDia = document.getElementById('tituloReservasDia');
                if (tituloDia) {
                    const fecha = new Date(fechaStr);
                    tituloDia.textContent = `Reservas del ${fecha.toLocaleDateString('es-ES', {
                        weekday: 'long',
                        day: 'numeric',
                        month: 'long'
                    })}`;
                }

                // Consulta a Firestore (sin ordenar)
                const fechaInicio = new Date(fechaStr + 'T00:00:00');
                const fechaFin = new Date(fechaStr + 'T23:59:59');
                const q = db.collection("reservas")
                    .where("fecha", ">=", fechaInicio)
                    .where("fecha", "<=", fechaFin)
                    .where('estado', 'in', ['confirmada', 'pendiente', 'examen']); // Solo estos estados
                
                const querySnapshot = await q.get();

                if (querySnapshot.empty) {
                    lista.innerHTML = '<div class="sin-reservas"><em>No hay reservas este día</em></div>';
                    return;
                }

                // Convertir documentos a array
                const reservas = [];
                querySnapshot.forEach(doc => {
                    const reserva = doc.data();
                    reserva.id = doc.id;
                    reservas.push(reserva);
                    //console.log(reserva.usuarioNombre);
                });
                //console.table(reservas);
                // Obtener usuarioIds únicos
                const usuarioIds = [...new Set(reservas.map(r => r.usuarioId))];
                
                // Consultar los usuarios (en lotes de 10)
                let usuarios = {};
                for (let i = 0; i < usuarioIds.length; i += 10) {
                    const batchIds = usuarioIds.slice(i, i + 10);
                    const usuariosSnapshot = await db.collection("usuarios_registrados")
                        .where("usuarioId", "in", batchIds)
                        .get();
                    
                    usuariosSnapshot.forEach(doc => {
                        const data = doc.data();                        
                        usuarios[data.usuarioId] = {
                            nombre: data.nombre,
                            apellidos: data.Apellidos
                        };
                    });
                }
                //console.table(usuarios);

                // Añadir nombre y apellidos a cada reserva
                reservas.forEach(reserva => {
                    reserva.nombre = usuarios[reserva.usuarioId]?.nombre || "";
                    reserva.apellidos = usuarios[reserva.usuarioId]?.apellidos || "";
                });

                // Ordenar por hora de inicio (ascendente)
                reservas.sort((a, b) => horaAminutos(a.hora) - horaAminutos(b.hora));

                // Mostrar en el DOM
                lista.innerHTML = '';
                reservas.forEach(reserva => {
                    const div = document.createElement('div');
                    div.className = `reserva-dia-item ${reserva.estado}`;

                    div.innerHTML = `
                            <div class="reserva-hora">
                                <span class="hora">${reserva.hora}</span>&nbsp;&nbsp;&nbsp;
                                <span class="hora">${reserva.nombre}</span>&nbsp;
                                <span class="hora">${reserva.apellidos}</span>&nbsp;&nbsp;&nbsp;
                                <span class="estado ${reserva.estado}">${reserva.estado}</span>
                            </div>
                        `;
                    lista.appendChild(div);
                });

            } catch (error) {
                console.error("Error:", error);
                lista.innerHTML = '<div class="error">Error al cargar reservas</div>';
            }
        }


        function horaAminutos(horaRango) {
            try {
                const [inicio] = horaRango.split(' a '); // Extrae la hora inicial
                const [hora, minutos] = inicio.split(':').map(Number);
                return hora * 60 + minutos;
            } catch (error) {
                console.error("Error al parsear la hora:", horaRango);
                return 0; // Si hay error, trata como 0 minutos (puedes ajustarlo)
            }
        }


        function mostrarEventosDelDia(fechaStr) {
            const eventos = calendar.getEvents();
            const eventosDelDia = eventos.filter(evento => {
                const inicio = evento.start?.toISOString().split('T')[0];
                return inicio === fechaStr;
            });

            //console.log("Eventos en", fechaStr, ":", eventosDelDia);
        }

        // Inicializar FullCalendar
        function inicializarCalendario() {
            const calendarEl = document.getElementById('calendar');
            if (!calendarEl) {
                alert("No se encontró el div con id 'calendar'");
                return;
            }

            const fechaActual = new Date(); // O fija la fecha si es para pruebas
            const year = fechaActual.getFullYear();
            const month = fechaActual.getMonth(); // 0-indexed

            // Primer día del mes actual
            const start = new Date(year, month, 1);
            // Último día del mes siguiente
            const end = new Date(year, month + 2, 0); // Día 0 del mes+2 es el último del mes+1

            calendar = new FullCalendar.Calendar(calendarEl, {
                //plugins: [dayGridPlugin, interactionPlugin],
                initialView: 'dayGridMonth',
                locale: 'es',
                titleFormat: { year: 'numeric', month: 'long' },
                firstDay: 1,
                validRange: {
                    start: start.toISOString().split('T')[0],
                    end: end.toISOString().split('T')[0]
                },
                //height: 'auto',
                aspectRatio: 0.8, // Menor = más compacto verticalmente
                fixedWeekCount: false, // Elimina filas vacías
                expandRows: false, // Evita que las filas se expandan
                //events: [],
                dateClick: function (info) {
                    cargarReservasDelDia(info.dateStr);
                },
                dayCellContent: function (info) {
                    // Corrige la fecha para la zona horaria local
                    const fechaLocal = new Date(info.date.getTime() - (info.date.getTimezoneOffset() * 60000)).toISOString().slice(0, 10); // Formato YYYY-MM-DD local

                    // 2. Verifica que la fecha exista en reservasTodas
                    const reservas = reservasTodas[fechaLocal] || { confirmadas: 0, pendientes: 0, examen: 0 };
                    let dotp = '', dotc = '', dote = '';
                    if (reservas.examen > 0) {
                        dote = `<span style = "display: inline-flex;justify-content: center;align-items: center;width: 18px;height: 18px;border-radius: 50%;background: #ef63f8;color: white;font-size: 12px;font-weight: bold;margin-left: 4px;vertical-align: middle;line-height: 1;">${reservas.examen}</span>`;
                    }
                    if (reservas.pendientes > 0) {
                        dotp = `<span style = "display: inline-flex;justify-content: center;align-items: center;width: 18px;height: 18px;border-radius: 50%;background: #FF9800;color: white;font-size: 12px;font-weight: bold;margin-left: 4px;vertical-align: middle;line-height: 1;">${reservas.pendientes}</span>`;
                    }
                    if (reservas.confirmadas > 0) {
                        dotc = `<span style = "display: inline-flex;justify-content: center;align-items: center;width: 18px;height: 18px;border-radius: 50%;background: #4CAF50;color: white;font-size: 12px;font-weight: bold;margin-left: 4px;vertical-align: middle;line-height: 1;">${reservas.confirmadas}</span>`;
                    }                    
                    return { html: info.dayNumberText + dote + dotp + dotc };
                }
            });
            calendar.render();
        }

        // Mostrar todas las reservas en el calendario
        function mostrarReservasCalendario() {
            calendar.removeAllEvents();

            const eventos = Object.values(reservasTodas)
                .flatMap(reservasDelDia => {
                    // Si reservasDelDia tiene la propiedad 'reservas' y es un array:
                    if (reservasDelDia && Array.isArray(reservasDelDia.reservas)) {
                        return reservasDelDia.reservas
                            .filter(r => ['confirmada', 'pendiente', 'examen'].includes(r.estado)) // Incluye "examen"
                            .map(r => ({
                                start: r.fecha.toDate ? r.fecha.toDate() : r.fecha,
                                backgroundColor:
                                    r.estado === 'confirmada' ? '#4CAF50' :
                                        r.estado === 'examen' ? '#1976d2' : // Color especial para examen
                                            '#FF9800',
                                textColor: '#fff'
                            }));
                    }
                    // Si reservasDelDia ES un array directamente:
                    if (Array.isArray(reservasDelDia)) {
                        return reservasDelDia
                            .filter(r => ['confirmada', 'pendiente', 'examen'].includes(r.estado))
                            .map(r => ({
                                start: r.fecha.toDate ? r.fecha.toDate() : r.fecha,
                                backgroundColor:
                                    r.estado === 'confirmada' ? '#4CAF50' :
                                        r.estado === 'examen' ? '#1976d2' :
                                            '#FF9800',
                                textColor: '#fff'
                            }));
                    }
                    return [];
                });

            calendar.addEventSource(eventos);
        }


        // Mostrar reservas del usuario autenticado
        function mostrarReservasUsuario() {
            const lista = document.getElementById('lista-reservas');
            lista.innerHTML = "";
            if (reservasUsuario.length === 0) {
                lista.innerHTML = "<em>No tienes reservas aún.</em>";
                return;
            }
            reservasUsuario
                .sort((a, b) => new Date(a.fecha) - new Date(b.fecha))
                .forEach(r => {
                    const div = document.createElement('div');
                    div.className = `reserva-item ${r.estado}`;
                    const fechaTexto = new Date(r.fecha).toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric', month: 'short' });
                    if (r.estado == 'pendiente') div.innerHTML = `<div class="reserva-item-compacta"><span class="reserva-fecha">📅 ${new Date(r.fecha).toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric', month: 'short' })}</span ><span class="reserva-hora">⏰ ${r.hora}</span ><button onclick="anularReserva('${r.fecha}', '${r.hora}', 'pendiente')" class='cta-btn-pendiente'>anular</button></div>`;
                    //if (r.estado == 'confirmada') div.innerHTML = `<div class="reserva-item-compacta"><span class="reserva-fecha">📅 ${new Date(r.fecha).toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric', month: 'short' })}</span ><span class="reserva-hora">⏰ ${r.hora}</span ><div class='cta-btn'style ='background: linear-gradient(90deg, #56ab2f 30%, #a8e063 100%); box-shadow: 0 4px 16px rgba(255, 65, 108, 0.15);'>confirmada</div></div>`;
                    if (r.estado == 'confirmada') {

                        if (esMenosDe24Horas(r.fecha, r.hora)) {
                            // Botón deshabilitado
                            div.innerHTML = `<div class="reserva-item-compacta"><span class="reserva-fecha">📅 ${fechaTexto}</span><span class="reserva-hora">⏰ ${r.hora}</span><button disabled class='cta-btn-confirmada-disabled' title="No se puede anular a menos de 24h o reservas pasadas">confirmada</button></div>`;
                        } else {
                            div.innerHTML = `<div class="reserva-item-compacta"><span class="reserva-fecha">📅 ${new Date(r.fecha).toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric', month: 'short' })}</span ><span class="reserva-hora">⏰ ${r.hora}</span ><button onclick="anularReserva('${r.fecha}', '${r.hora}', 'confirmada')" class='cta-btn-confirmada'>confirmada</button></div>`;

                        }
                    }
                    //if (r.estado == 'anulada') div.innerHTML = `<div class="reserva-item-compacta"><span class="reserva-fecha">📅 ${new Date(r.fecha).toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric', month: 'short' })}</span ><span class="reserva-hora">⏰ ${r.hora}</span ><div class='cta-btn'style ='background: linear-gradient(90deg, #ff6a6a 30%, #ffe0e0 100%);'>anulada</div></div>`;

                    lista.appendChild(div);
                });
        }

        // Función para saber si faltan menos de 24h para la reserva
        function esMenosDe24Horas(fechaStr, horaStr) {
            // fechaStr: 'YYYY-MM-DD', horaStr: 'HH:MM a HH:MM'
            const ahora = new Date();
            const [anio, mes, dia] = fechaStr.split('-').map(Number);
            const horaInicioStr = horaStr.split('a')[0].trim(); // "HH:MM"
            const [h, m] = horaInicioStr.split(':').map(Number);
            const fechaHoraReserva = new Date(anio, mes - 1, dia, h, m, 0, 0);
            const diferenciaMs = fechaHoraReserva - ahora;
            const horasRestantes = diferenciaMs / (1000 * 60 * 60);
            return horasRestantes < 24;
        }

        async function cargarReservas() {
            // Todas las reservas para el calendario
            db.collection('reservas').onSnapshot(snapshot => {
                reservasTodas = {};
                snapshot.forEach(doc => {
                    const reserva = doc.data();
                    //console.log(reserva);
                    if (reserva.fecha?.toDate) { // Validar existencia de fecha
                        const fechaDate = reserva.fecha.toDate();
                        // Convertir a fecha local (ej: España)
                        const fechaStr = fechaDate.toLocaleDateString("es-ES", {
                            timeZone: "Europe/Madrid",
                            year: "numeric",
                            month: "2-digit",
                            day: "2-digit"
                        }).split("/").reverse().join("-"); // Formato YYYY-MM-DD

                        if (!reservasTodas[fechaStr]) {
                            reservasTodas[fechaStr] = { confirmadas: 0, pendientes: 0, examen: 0 };
                        }

                        if (reserva.estado === 'confirmada') reservasTodas[fechaStr].confirmadas++;
                        if (reserva.estado === 'pendiente') reservasTodas[fechaStr].pendientes++;
                        if (reserva.estado === 'examen') reservasTodas[fechaStr].examen++;
                        //console.log("Datos cargados (LOCALES):", reservasTodas);
                    } else {
                        console.error("Documento sin campo 'fecha':", doc.id);
                    }

                    //console.log("Datos actualizados (LOCALES):", reservasTodas);
                    if (calendar) calendar.refetchEvents(); // Actualizar calendario
                });

                // Solo inicializa el calendario la primera vez
                if (primeraCarga) {
                    inicializarCalendario();
                    primeraCarga = false;
                }
                //console.table(reservasTodas);
                //console.log("Datos actualizados:", reservasTodas);
                mostrarReservasCalendario();
            });


            // Reservas del usuario autenticado
            /*db.collection('reservas')
                .where('usuarioId', '==', usuarioActual.uid)
                .onSnapshot(snapshot => {
                    reservasUsuario = [];
                    snapshot.forEach(doc => {
                        const d = doc.data();
                        if (d.fecha?.toDate) { // <-- Añade validación aquí
                            reservasUsuario.push({
                                ...d,
                                fecha: d.fecha.toDate().toISOString().split('T')[0],
                                id: doc.id
                            });
                        } else {
                            console.error("Documento del usuario sin 'fecha' válida:", doc.id);
                        }
                    });
                    mostrarReservasUsuario();
                });*/
        }


        function parseFechaFirestore(fechaStr) {
            // Traducir el mes de español a inglés
            const meses = {
                'enero': 'Enero', 'febrero': 'Febrero', 'marzo': 'Marzo', 'abril': 'Abril', 'mayo': 'Mayo',
                'junio': 'Junio', 'julio': 'Julio', 'agosto': 'Agosto', 'septiembre': 'Septiembre', 'octubre': 'Octubre',
                'noviembre': 'Noviembre', 'diciembre': 'Diciembre'
            };
            let fechaEn = fechaStr;
            for (let [es, en] of Object.entries(meses)) {
                if (fechaEn.includes(es)) {
                    fechaEn = fechaEn.replace(es, en);
                    break;
                }
            }
            // Eliminar 'UTC+2' y ajustar am/pm
            fechaEn = fechaEn.split(' UTC')[0]
                .replace(' a.m.', ' AM')
                .replace(' p.m.', ' PM')
                .replace(' de ', ' ');

            // Parsear a Date
            // Ejemplo: '12 May 2025, 2:00:00 AM'
            const fechaDate = new Date(Date.parse(fechaEn));

            // Ajustar a UTC si es necesario (ejemplo: restar 2 horas si era UTC+2)
            // En este ejemplo, la hora ya está en local, así que para UTC:
            fechaDate.setHours(fechaDate.getHours() - 2);

            return fechaDate;
        }

        async function logCredito({
            usuarioId,
            email,
            perfil,
            creditosAntes,
            tipo, // "sumar" o "restar"
            creditosDespues,
            reservasImplicadas
        }) {
            try {
                await db.collection("logcreditos").add({
                    fecha: firebase.firestore.FieldValue.serverTimestamp(),
                    usuarioId,
                    email,
                    perfil,
                    creditosAntes,
                    tipo,
                    creditosDespues,
                    reservasImplicadas
                });
                console.log("Log de crédito guardado correctamente");
            } catch (error) {
                console.error("Error al guardar el log de créditos:", error);
            }
        }

        const btnAyuda = document.getElementById('btnAyuda');
        const popupAyuda = document.getElementById('popupAyuda');
        const closeBtn = document.querySelector('.close');

        const ayudaCalendario = `<h3>Uso de la administracion de reservas para practicas</h3>
<p>Aquí puedes ver todas las reservas solicitadas al profesor de practicas. Asignar un nuevo alumno al profesor. Verás las clases que les quedan a los alumnos por realizar. Añadir o borrar clases a los alumnos. Verás un historico de solicitudes de clases realizadas por los alumnos, ya sean solicitadas, anuladas o confirmadas.</p>
<ul>
        <li><strong>Nuevo alumno:</strong> Podrás añadir un nuevo alumno al profesor.</li>
        <li><strong>Listado de alumnos:</strong> Podrás visualizar el listado de alumnos que tiene asignado el profesor. Borrar alumnos. En clases podrás añadirles y borrarles clases, así como visualizar un historico de los movimientos producidos en la gestion de sus clases.</li>
        <li><strong>Calendario:</strong> Podrás ver todas las peticiones de reservas al profesor de practicas solicitadas por todos los alumnos, ya esten pendientes de confirmar por él, ó bien ya confirmadas.</li>
        <li><strong>Reservas del día:</strong> Si haces clic en una fecha del calendario, visualizaras en este apartado todas las reservas solicitadas por todos los alumnos para ese dia tanto si están pendientes como confirmadas.</li>
</ul>
`;

        btnAyuda.addEventListener('click', () => {
            popupAyuda.style.display = 'flex';
        });

        closeBtn.addEventListener('click', () => {
            popupAyuda.style.display = 'none';
        });

        // Cierra el popup si se hace clic fuera del contenido
        popupAyuda.addEventListener('click', (e) => {
            if (e.target === popupAyuda) {
                popupAyuda.style.display = 'none';
            }
        });

        //----------------------------------------------------------------------------------------------------------
        //crear contenido html de Planificacion.html para crear pdf
        let currentDate = new Date(); // Fecha actual
        currentDate.setHours(0, 0, 0, 0); // Normaliza la hora

        function formatDate(date) {
            // Formatea en hora local (ej: 2025-05-19)
            return date.toLocaleDateString('en-CA'); // Formato "YYYY-MM-DD" en local
        }

        document.getElementById('descargar-pdf').addEventListener('click', function () {
            
            cargarTimeSlots();
            const grid = document.getElementById('div-pdf');
            const imagenBase64 = "data:image/png;base64,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";

            if (grid) {
                setTimeout(() => {
                    html2pdf()
                        .set({
                            margin: 10,
                            filename: 'ParteSemanal.pdf',
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { scale: 2 },
                            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                        })
                        .from(document.getElementById('div-pdf'))
                        .toPdf()
                        .get('pdf')
                        .then(function (pdf) {
                            pdf.addPage();
                            // Para A4: 210 x 297 mm. Ajusta si tu imagen tiene otras dimensiones.
                            pdf.addImage(imagenBase64, 'JPEG', 0, 0, 210, 297);
                        })
                        .save();
                }, 1000);
            } else {
                alert('No se encontró el div.');
            }
        
        });

        // Devuelve array de fechas para la UI
        function getWeekDatesArray(date) {
            const start = new Date(date);
            start.setDate(date.getDate() - date.getDay() + (date.getDay() === 0 ? -6 : 1)); // Lunes
            start.setHours(0, 0, 0, 0);

            const dates = [];
            for (let i = 0; i < 5; i++) { // Solo 5 días (lunes a viernes)
                const current = new Date(start);
                current.setDate(start.getDate() + i);
                dates.push(current);
            }
            return dates;
        }

        // Devuelve { start, end } para consultas
        function getWeekRange(date) {
            const start = new Date(date);
            start.setDate(date.getDate() - date.getDay() + (date.getDay() === 0 ? -6 : 1));
            start.setHours(0, 0, 0, 0);

            const end = new Date(start);
            end.setDate(start.getDate() + 6);
            end.setHours(23, 59, 59, 999);

            return { start, end };
        }

        let timeSlots = []; // Inicialmente vacío

        async function cargarTimeSlots() {
            try {
                const doc = await db.collection("configuracion").doc("horarios").get();
                if (doc.exists && Array.isArray(doc.data().slots)) {
                    timeSlots = doc.data().slots;

                    // Ordenar los tramos horarios por la hora de inicio
                    timeSlots.sort((a, b) => {
                        // Extrae la hora de inicio (antes del primer espacio o "a")
                        const horaA = a.split(" a ")[0];
                        const horaB = b.split(" a ")[0];
                        // Convierte a minutos para comparar
                        const [hA, mA] = horaA.split(":").map(Number);
                        const [hB, mB] = horaB.split(":").map(Number);
                        return hA * 60 + mA - (hB * 60 + mB);
                    });

                    createCalendar();
                    //cargarHoras();
                } else {
                    console.error("No se encontraron tramos horarios en Firestore.");
                    // Usar valores por defecto si es necesario
                    timeSlots = ["07:30 a 08:50", "09:00 a 10:20", "10:30 a 11:50", "12:00 a 13:20", "13:30 a 14:50"];
                    //updateWeekDisplay();
                    createCalendar();
                }
            } catch (error) {
                console.error("Error al cargar los tramos horarios:", error);
                // Usar valores por defecto si hay error
                timeSlots = ["07:30 a 08:50", "09:00 a 10:20", "10:30 a 11:50", "12:00 a 13:20", "13:30 a 14:50"];
                //updateWeekDisplay();
                createCalendar();
            }
        }

        let examenes = 0;
        let clases = 0;

        async function loadReservations() {
            try {
                
                // Limpia reservas anteriores
                document.querySelectorAll('.reserva').forEach(el => el.remove());

                // Obtén el rango de la semana (para consulta)
                const { start, end } = getWeekRange(currentDate);
                //console.log("Consultando desde:", start, "hasta:", end);

                // Consulta Firestore
                const q = db.collection("reservas")
                    .where("fecha", ">=", firebase.firestore.Timestamp.fromDate(start))
                    .where("fecha", "<=", firebase.firestore.Timestamp.fromDate(end))
                    .where('estado', 'in', ['confirmada', 'pendiente', 'examen']) // Solo estos estados
                    .orderBy('fecha', 'desc');

                const querySnapshot = await q.get();

                // Limpia reservas anteriores
                document.querySelectorAll('.reserva').forEach(el => el.remove());

                // Procesa e inserta en el calendario
                querySnapshot.forEach(doc => {
                    const reserva = doc.data();
                    reserva.id = doc.id;
                    const fecha = reserva.fecha.toDate();
                    const fechaFormateada = formatDate(fecha);
                    const hora = reserva.hora.trim();
                    const estado = reserva.estado.toLowerCase(); // Asegura minúsculas                    
                    const cell = document.querySelector(`[data-date="${fechaFormateada}"][data-hora="${hora}"]`);
                    /*const cells = document.querySelectorAll(`[data-date="${fechaFormateada}"]`);
                    cells.forEach(cell => {
                        console.log('estado:', estado);
                        console.log('fecha Firestore:', fechaFormateada);
                        console.log('Posible hora:', cell.getAttribute('data-hora'));
                        console.log('hora Firestore:', hora);
                    });*/
                    //console.log('Buscando celda:', `[data-date="${fechaFormateada}"][data-hora="${hora}"]`);

                    //console.log('Reserva:', fechaFormateada, hora);
                    //console.log('¿Existe cells?', !!cells, cells);
                    
                                      
                    if (cell) {
                        const reservaElement = document.createElement('div');
                        reservaElement.className = `reserva ${estado}`; // Clase dinámica según estado
                        //reservaElement.innerHTML = `<span>${reserva.usuarioNombre}</span><small>${reserva.estado}</small>`;
                        reservaElement.innerHTML = `<span>${reserva.usuarioNombre}</span>`;
                        reservaElement.dataset.reservaId = reserva.id; // Añade el id
                        reservaElement.dataset.estado = estado;
                        reservaElement.dataset.email = reserva.usuarioEmail || ''; // Si tienes el email                                                   

                        if (estado === 'pendiente' || estado === 'confirmada' || estado === 'examen') {
                            reservaElement.addEventListener('click', function (e) {
                                e.stopPropagation();
                                mostrarMenuContextual(reserva, reservaElement, estado);
                            });
                        }

                        cell.appendChild(reservaElement);

                        if (estado == 'confirmada') clases++;
                        if (estado == 'examen') examenes++;
                    }

                });
                
            } catch (error) {
                console.error("Error al cargar reservas:", error);
            }
        }

        function createCalendar() {
            const grid = document.getElementById('div-pdf');
            grid.innerHTML = '';
            grid.innerHTML = `<div class="divpdfh" style="grid-column: 1 / -1;"><h3>Parte semanal Carlos</h3></div>`;

            const weekDates = getWeekDatesArray(currentDate);

            // 1. Fila del mes (esquina + mes)
            // Obtén el mes y el año del primer día de la semana
            const mes = weekDates[0].toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
            // Esquina superior izquierda vacía
            grid.innerHTML += `<div class="time-slot"></div>`;
            // Mes (ocupa 5 columnas, igual que los días)
            grid.innerHTML += `<div class="month-header" style="grid-column: 2 / span 5; text-align:center; font-weight:bold; font-size:1.1em; background:#e3eafc; color:#1976d2; border-radius:6px 6px 0 0;">${mes.charAt(0).toUpperCase() + mes.slice(1)}</div>`;

            // Esquina superior izquierda
            grid.innerHTML += `<div class="time-slot"></div>`;

            // Encabezados de los días de la semana (solo lunes a viernes)
            weekDates.forEach(date => {
                grid.innerHTML += `<div class="day-header">${date.toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric' })}</div>`;
            });

            // Filas: cada tramo horario
            timeSlots.forEach(slot => {
                grid.innerHTML += `<div class="time-slot">${slot}</div>`;
                weekDates.forEach(date => {
                    grid.innerHTML += `<div class="calendar-cell" data-date="${formatDate(date)}" data-hora="${slot}"></div>`;
                });
            });

            //loadReservations();            
            //grid.innerHTML += `<div class="divZum" style="grid-column: 1 / -1;"><h3>Total clases = ${clases}</h3><h3>Total Examenes = ${examenes}</h3></div>`;
            loadReservations().then(() => {
                grid.innerHTML += `<div class="divZum" style="grid-column: 1 / -1;"><h3>Total clases = ${clases}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total Examenes = ${examenes}</h3></div>`;
            });
        }

        async function cargarHoras() {
            // Añade cada tramo como opción
            //console.table(timeSlots);
            //let timeExams = ["08:00 a 08:30", "08:30 a 09:00", "09:00 a 09:30", "09:30 a 10:00", "10:00 a 10:30", "10:30 a 11:00", "11:00 a 11:30"];
            const selectHora = document.getElementById('hora');
            if (!selectHora) return;

            // Limpia las opciones anteriores
            selectHora.innerHTML = '';

            timeSlots.forEach(timeslot => {
                const option = document.createElement('option');
                option.value = timeslot;
                option.textContent = timeslot;
                selectHora.appendChild(option);
            });
        }


    </script>
</body>
</html>
